<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISS Data Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; }
        .lang-btn.active { background-color: #0ea5e9; }
        #issMap { height: 100%; min-height: 400px; width: 100%; border-radius: 0.5rem; z-index: 0;}
        .dashboard-card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); padding: 1.5rem; }
    </style>
</head>
<body class="text-slate-800">
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold" data-translate-key="header_title">ISS Data Dashboard</h1>
                <p class="text-sm text-slate-500" data-translate-key="header_subtitle">Real-Time Information Hub</p>
            </div>
            <div class="flex items-center space-x-4">
                 <a href="index.html" class="hidden sm:block text-sky-600 hover:underline" data-translate-key="back_to_main">Back to Main Site</a>
                 <div>
                    <button id="lang-pt" onclick="setLanguage('pt')" class="lang-btn bg-slate-200 hover:bg-sky-600 hover:text-white font-bold py-1 px-3 rounded-l-lg text-sm transition-colors">PT</button>
                    <button id="lang-en" onclick="setLanguage('en')" class="lang-btn bg-slate-200 hover:bg-sky-600 hover:text-white font-bold py-1 px-3 rounded-r-lg text-sm transition-colors">EN</button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-2 space-y-6">
                <div class="dashboard-card h-full flex flex-col">
                    <h2 class="text-xl font-semibold mb-4" data-translate-key="map_title">ISS Current Location</h2>
                    <div id="issMap" class="flex-grow"></div>
                    <p class="text-xs text-slate-400 mt-2 text-center" data-translate-key="map_note">
                        Map labels are provided by OpenStreetMap and may not reflect the selected language.
                    </p>
                </div>
            </div>

            <div class="space-y-6">
                <div class="dashboard-card">
                    <h2 class="text-xl font-semibold mb-4" data-translate-key="flight_data_title">Live Flight Data</h2>
                    <div class="space-y-3 text-slate-600">
                        <p><strong data-translate-key="latitude">Latitude:</strong> <span id="lat">...</span></p>
                        <p><strong data-translate-key="longitude">Longitude:</strong> <span id="lon">...</span></p>
                        <p><strong data-translate-key="altitude">Altitude:</strong> <span id="alt">...</span> km</p>
                        <p><strong data-translate-key="velocity">Velocity:</strong> <span id="vel">...</span> km/h</p>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h2 class="text-xl font-semibold mb-4" data-translate-key="crew_title">Who is in Space?</h2>
                    <ul id="crew-list" class="space-y-3 text-slate-600">
                        <li data-translate-key="loading">Loading...</li>
                    </ul>
                </div>
                 <div class="dashboard-card">
                    <h2 class="text-xl font-semibold mb-4" data-translate-key="presence_title">Continuous Human Presence</h2>
                    <div id="presence-counter" class="grid grid-cols-5 text-center">
                        <div><span id="years" class="text-3xl font-bold text-sky-600">0</span><p class="text-xs text-slate-500" data-translate-key="years_label">Years</p></div>
                        <div><span id="days" class="text-3xl font-bold text-sky-600">0</span><p class="text-xs text-slate-500" data-translate-key="days_label">Days</p></div>
                        <div><span id="hours" class="text-3xl font-bold text-sky-600">00</span><p class="text-xs text-slate-500" data-translate-key="hours_label">Hours</p></div>
                        <div><span id="minutes" class="text-3xl font-bold text-sky-600">00</span><p class="text-xs text-slate-500" data-translate-key="minutes_label">Mins</p></div>
                        <div><span id="seconds" class="text-3xl font-bold text-sky-600">00</span><p class="text-xs text-slate-500" data-translate-key="seconds_label">Secs</p></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentLanguage = localStorage.getItem('language') || 'en';
        const translations = {
            pt: {
                header_title: "Painel de Dados da ISS", header_subtitle: "Central de Informações em Tempo Real", back_to_main: "Voltar ao Site Principal",
                map_title: "Localização Atual da ISS", flight_data_title: "Dados de Voo em Direto",
                latitude: "Latitude:", longitude: "Longitude:", altitude: "Altitude:", velocity: "Velocidade:",
                crew_title: "Quem está no Espaço?",
                presence_title: "Presença Humana Contínua",
                years_label: "Anos", days_label: "Dias", hours_label: "Horas", minutes_label: "Min", seconds_label: "Seg",
                loading: "A carregar...",
                map_note: "Os nomes no mapa são fornecidos pelo OpenStreetMap e podem não refletir o idioma selecionado."
            },
            en: {
                header_title: "ISS Data Dashboard", header_subtitle: "Real-Time Information Hub", back_to_main: "Back to Main Site",
                map_title: "ISS Current Location", flight_data_title: "Live Flight Data",
                latitude: "Latitude:", longitude: "Longitude:", altitude: "Altitude:", velocity: "Velocity:",
                crew_title: "Who is in Space?",
                presence_title: "Continuous Human Presence",
                years_label: "Years", days_label: "Days", hours_label: "Hours", minutes_label: "Mins", seconds_label: "Secs",
                loading: "Loading...",
                map_note: "Map labels are provided by OpenStreetMap and may not reflect the selected language."
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang; localStorage.setItem('language', lang);
            document.documentElement.lang = currentLanguage === 'pt' ? 'pt-BR' : 'en-US';
            document.querySelectorAll('[data-translate-key]').forEach(el => { el.innerText = translations[currentLanguage][el.getAttribute('data-translate-key')] || el.innerText; });
            document.getElementById('lang-pt').classList.toggle('active', currentLanguage === 'pt');
            document.getElementById('lang-en').classList.toggle('active', currentLanguage === 'en');
        }

        const map = L.map('issMap').setView([0, 0], 2);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
        const issIcon = L.icon({ iconUrl: 'https://upload.wikimedia.org/wikipedia/commons/d/d0/International_Space_Station.svg', iconSize: [50, 50], iconAnchor: [25, 25], });
        const marker = L.marker([0, 0], {icon: issIcon}).addTo(map);

        async function getISSData() {
            try {
                const response = await fetch('https://api.wheretheiss.at/v1/satellites/25544');
                const data = await response.json();
                const { latitude, longitude, altitude, velocity } = data;
                marker.setLatLng([latitude, longitude]); map.panTo([latitude, longitude], { animate: true, duration: 1.0 });
                document.getElementById('lat').textContent = latitude.toFixed(4);
                document.getElementById('lon').textContent = longitude.toFixed(4);
                document.getElementById('alt').textContent = altitude.toFixed(2);
                document.getElementById('vel').textContent = velocity.toFixed(2);
            } catch (error) { console.error("Error fetching ISS data:", error); }
        }
        
        // --- FUNÇÃO DE TRIPULAÇÃO COM FALLBACK À PROVA DE FUTURO ---
        function displayFallbackCrewData() {
            const crewList = document.getElementById('crew-list');
            // LISTA ATUALIZADA com tripulação atual e futura (final de 2025 / início de 2026)
            const fallbackCrew = [
                { name: 'Oleg Kononenko', flag: '🇷🇺' }, { name: 'Nikolai Chub', flag: '🇷🇺' },
                { name: 'Tracy C. Dyson', flag: '🇺🇸' }, { name: 'Matthew Dominick', flag: '🇺🇸' },
                { name: 'Alexander Grebenkin', flag: '🇷🇺' }, { name: 'Scott D. Tingle', flag: '🇺🇸' },
                { name: 'Michael Fincke', flag: '🇺🇸' }, { name: 'Joshua Kutryk', flag: '🇨🇦' },
            ];
            
            crewList.innerHTML = '';
            fallbackCrew.forEach(person => {
                const li = document.createElement('li');
                li.className = 'flex items-center';
                li.innerHTML = `<span class="mr-2 text-xl">${person.flag}</span> ${person.name}`;
                crewList.appendChild(li);
            });
        }

        async function getCrewData() {
            const crewList = document.getElementById('crew-list');
            const crewApiUrl = `https://corsproxy.io/?${encodeURIComponent('http://api.open-notify.org/astros.json')}`;
            
            try {
                const response = await fetch(crewApiUrl, { signal: AbortSignal.timeout(8000) });
                if (!response.ok) { throw new Error('Response not OK'); }
                const data = await response.json();

                if (data.people && data.people.length > 0) {
                    crewList.innerHTML = '';
                    const issCrew = data.people.filter(person => person.craft === 'ISS');
                    const countryFlags = { 'USA': '🇺🇸', 'Russia': '🇷🇺' };
                    
                    issCrew.forEach(person => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center';
                        const flag = person.name.includes(' ') ? countryFlags['USA'] : countryFlags['Russia']; 
                        li.innerHTML = `<span class="mr-2 text-xl">${flag || '🏴‍☠️'}</span> ${person.name}`;
                        crewList.appendChild(li);
                    });
                } else {
                    throw new Error('No crew data in response');
                }
            } catch (error) {
                console.warn("Live crew data failed, using future-proof fallback.", error);
                displayFallbackCrewData();
            }
        }
        
        function updatePresenceCounter() {
            const firstCrewArrival = new Date('2000-11-02T09:00:00Z');
            const now = new Date();
            let diff = now - firstCrewArrival;
            const msInDay = 1000 * 60 * 60 * 24;

            let years = now.getUTCFullYear() - firstCrewArrival.getUTCFullYear();
            let lastAnniversary = new Date(Date.UTC(now.getUTCFullYear(), firstCrewArrival.getUTCMonth(), firstCrewArrival.getUTCDate(), 9, 0, 0));
            if (now < lastAnniversary) {
                years--;
                lastAnniversary.setUTCFullYear(lastAnniversary.getUTCFullYear() - 1);
            }
            const daysSinceAnniversary = Math.floor((now - lastAnniversary) / msInDay);
            
            const hours = Math.floor((diff % msInDay) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            document.getElementById('years').textContent = years;
            document.getElementById('days').textContent = daysSinceAnniversary;
            document.getElementById('hours').textContent = String(hours).padStart(2, '0');
            document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
            document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
        }

        document.addEventListener('DOMContentLoaded', () => {
            setLanguage(currentLanguage);
            getISSData();
            getCrewData();
            updatePresenceCounter();
            setInterval(getISSData, 5000);
            setInterval(updatePresenceCounter, 1000);
        });
    </script>
</body>
</html>


